<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Malla Curricular - Cs. Físicas</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f4f4f4;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
    }
    .materia {
      background: white;
      padding: 10px;
      margin: 5px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }
    .materia label {
      flex-grow: 1;
      margin-left: 10px;
    }
    .materia input[type="number"] {
      width: 50px;
      margin-left: 10px;
    }
    .anio {
      margin-bottom: 30px;
    }
    .optativas textarea {
      width: 100%;
      height: 80px;
    }
    .resumen {
      margin-top: 30px;
      padding: 15px;
      background: #e0e0e0;
      border-radius: 8px;
    }
    .toast {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: #333;
      color: white;
      padding: 10px 20px;
      border-radius: 8px;
      opacity: 0;
      transition: opacity 0.5s ease-in-out;
    }
    .toast.show {
      opacity: 1;
    }
  </style>
</head>
<body>
  <h1>Malla Curricular - Cs. Físicas</h1>
  <div id="contenedor"></div>
  <div class="optativas">
    <h2>Materias Optativas</h2>
    <textarea id="optativas"></textarea>
  </div>
  <div class="resumen" id="resumen"></div>
  <div class="toast" id="toast"></div>
  <script>
    const materias = {
      "CBC": ["Física", "Análisis Matemático", "Álgebra", "ICSE", "IPC"],
      "1er año": ["Física I", "Matemática I", "Matemática II"],
      "2do año": ["Física II", "Matemática III", "Laboratorio I"],
      "3er año": ["Física III", "Laboratorio II", "Matemática IV", "Computación"],
      "4to año": ["Física IV", "Laboratorio III", "Física Estadística", "Mecánica Cuántica I"],
      "5to año": ["Física V", "Laboratorio IV", "Electrodinámica Cuántica", "Seminario"]
    };

    const contenedor = document.getElementById("contenedor");

    for (const [anio, lista] of Object.entries(materias)) {
      const div = document.createElement("div");
      div.className = "anio";
      div.innerHTML = `<h2>${anio}</h2>`;

      for (const nombre of lista) {
        const estado = JSON.parse(localStorage.getItem(nombre) || '{}');
        const mat = document.createElement("div");
        mat.className = "materia";

        const check = document.createElement("input");
        check.type = "checkbox";
        check.checked = estado.regular || false;

        const label = document.createElement("label");
        label.innerText = nombre;
        label.title = "Click para marcar como regular";

        const nota = document.createElement("input");
        nota.type = "number";
        nota.placeholder = "Nota";
        nota.min = 1;
        nota.max = 10;
        nota.value = estado.nota || "";

        nota.addEventListener("blur", () => {
          const val = parseFloat(nota.value);
          if (nota.value && (isNaN(val) || val < 1 || val > 10)) {
            showToast("Ingrese una nota válida entre 1 y 10");
            nota.value = "";
            return;
          }
          localStorage.setItem(nombre, JSON.stringify({ regular: check.checked, nota: val || "" }));
          actualizarResumen();
          if (val >= 4) showToast("¡Felicidades por aprobar " + nombre + "!");
        });

        check.addEventListener("change", () => {
          localStorage.setItem(nombre, JSON.stringify({ regular: check.checked, nota: nota.value || "" }));
          actualizarResumen();
        });

        mat.appendChild(check);
        mat.appendChild(label);
        mat.appendChild(nota);
        div.appendChild(mat);
      }

      contenedor.appendChild(div);
    }

    const resumen = document.getElementById("resumen");
    const optativas = document.getElementById("optativas");
    optativas.value = localStorage.getItem("optativas") || "";
    optativas.addEventListener("input", () => localStorage.setItem("optativas", optativas.value));

    function actualizarResumen() {
      let total = 0, aprobadas = 0, suma = 0, cont = 0;

      for (const [anio, lista] of Object.entries(materias)) {
        for (const nombre of lista) {
          total++;
          const s = JSON.parse(localStorage.getItem(nombre) || '{}');
          if (s?.nota >= 4) {
            aprobadas++;
            suma += parseFloat(s.nota);
            cont++;
          }
        }
      }
      resumen.innerHTML = `Aprobadas: ${aprobadas} / ${total}<br>Promedio (sin CBC): ${cont > 0 ? (suma / cont).toFixed(2) : "-"}`;
    }

    function showToast(msg) {
      const toast = document.getElementById("toast");
      toast.textContent = msg;
      toast.className = "toast show";
      setTimeout(() => toast.className = "toast", 3000);
    }

    actualizarResumen();
  </script>
</body>
</html>
